<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>sign-up</title>

    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="../css/sign-up2.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Luckiest+Guy&family=Yeon+Sung&display=swap" rel="stylesheet">
</head>

<body>
    <header>
        <div id="wrap">
            <h1 class="logo"><a href="/main">Y⛺GAJA</a></h1>
            <div class="logo-content">
                <a href="/main/introduce">INTRO</a>
                <a href="/main/reservation">RESERVATION</a>
                <a href="/main/notice">NOTICE</a>
                <a href="/main/review">REVIEW</a>
            </div>
            <div class="login">
                <a href="/user/sign-in"><p>LOGIN</p></a><br>
            </div>
            <div class="logout">
                <a href="/user/sign-out">LOGOUT</a><br>
                <a href="/user/mypage">MYPAGE</a>
            </div>



            <!-- 로그인이 되어있으면 로그아웃이랑 마이페이지만 뜰수있도록

                <div class="login">
                <c:if test="${login == null}">
                    <a href="/user/sign-in">LOGIN</a><br>
                </c:if>


                <c:if test="${sessionScope.login != null}">
                    <a href="/user/sign-out">LOGOUT</a><br>
                    <a href="/user/mypage">MYPAGE</a>
                </c:if>
            </div> 

        -->


            


            <p class="menu-open">
                <span class="lnr lnr-menu"></span>
            </p>
        </div>

        <nav class="gnb">
            <p class="close">
                <span class="lnr lnr-cross"></span>
            </p>
            <ul>
                <li><a href="/main/introduce">INTRO</a></li>
                <li><a href="/main/reservation">RESERVATION</a></li>
                <li><a href="/main/notice">NOTICE</a></li>
                <li><a href="/main/review">REVIEW</a></li>
                <li><a href="/user/sign-in">LOGIN</a></li>
                <li><a href="/user/sign-out">LOGOUT</a></li>
                <li><a href="/user/mypage">MYPAGE</a></li>
            </ul>
        </nav>

        <script>
            //버튼의 요소 노드 취득
            const menuBtn = document.querySelector('header .menu-open');
            const closeBtn = document.querySelector('.gnb .close');

            const gnb = document.querySelector('.gnb');

            //클릭 이벤트 생성
            menuBtn.addEventListener('click', () => {
                gnb.classList.add('open');
            });

            closeBtn.addEventListener('click', () => {
                gnb.classList.remove('open');
            });
        </script>
        
    </header>


    <!-- 섹션 -->
    <section class="signup-list">
        <div class="signup-box">

            <h1>SIGN-UP</h1>

            <form action="/user/sign-up" name="signup" id="signUpForm" method="post">

                <table>
                    <tr>
                        <td>
                            <p><strong>이메일</strong>&nbsp;&nbsp;&nbsp;
                                <span id="emailChk"></span></p>
                        </td>
                    </tr>
                    <tr>
                        <td><input type="text" name="email" id="emailInput" maxlength="20" required="required"
                                aria-required="true" placeholder="abc1234@naver.com">
                        </td>

                    </tr>

                    <tr>
                        <td>
                            <p><strong>비밀번호</strong>&nbsp;&nbsp;&nbsp;<span id="pwChk"></span></p>
                        </td>
                    </tr>
                    <tr>
                        <td><input type="password" maxlength="20" id="password" name="password" maxlength="20"
                                required="required" aria-required="true" placeholder="영문과 특수문자를 포함한 최소 8자"></td>
                    </tr>
                    <tr>
                        <td>
                            <p><strong>비밀번호 재확인</strong>&nbsp;&nbsp;&nbsp;<span id="pwChk2"></span>
                            </p>
                        </td>
                    </tr>
                    <tr>
                        <td><input type="password" maxlength="20" id="password_check" name="pw_check"
                                maxlength="20" required="required" aria-required="true" placeholder="비밀번호가 일치해야합니다.">
                        </td>
                    </tr>

                    <tr>
                        <td>
                            <p><strong>이름</strong>&nbsp;&nbsp;&nbsp;<span id="nameChk"></span></p>
                        </td>
                    </tr>
                    <tr>
                        <td><input type="text" name="name" id="user_name" maxlength="6" required="required"
                                aria-required="true" placeholder="한글로 최대 6자"></td>
                    </tr>

                    <tr>
                        <td>
                            <p><strong>휴대폰 번호</strong>&nbsp;&nbsp;&nbsp;<span id="phoneNumberChk"></span></p>
                        </td>
                    </tr>
                    <tr>
                        <td><input type="text" name="phoneNumber" id="user_phone" required="required"
                                aria-required="true" placeholder="010-1234-5678"></td>
                    </tr>


                    <tr class="join-btn">
                        <td>
                            <input type="button" value="회원가입" class="btn" id="signup-btn">
                        </td>
                    </tr>

                </table>
            </form>
        </div>
    </section>



    <footer>
        <div class="footer-wrap">
            <div class="footer-content">
                <p>
                    상호 : YAGAJA &#124; 대표자명 : 홍길동 &#124; 사업자등록번호 : 123-12-1234 &#124; 주소 : 서울특별시 마포구 백범로 23, 3층 (신수동,
                    케이터틀)
                    &#124; 문의 : 02-123-1234
                </p>
                <br>
                <p>이용약관 &#124; 개인정보처리방침</p>
            </div>
            <h3 class="footer-logo">Y⛺GAJA</h3>
        </div>
    </footer>

    <script>

        // 입력값 검증 통과 여부 배열
        const checkResultList = [false, false, false, false, false];

        // 이메일 검사 정규표현식
        const emailPattern = /\S+@\S+\.\S+/;

        // 아이디 입력값 검증
        const $emailInput = document.getElementById('emailInput');

        // 키를 눌렀다 떼는 순간 이벤트 발생
        $emailInput.onkeyup = e => {

            const emailInput = $emailInput.value;
            // console.log(idValue);

            if (emailInput.trim() === '') {
            $emailInput.style.borderColor = 'red';
            document.getElementById('emailChk').innerHTML = '<b style="color: red; font-size: 20px;">[이메일은 필수값입니다!]</b>';
            checkResultList[0] = false;

            } else if (!emailPattern.test(emailInput)) {
            // 정규표현식의 함수 test를 통해서 입력값이 패턴에 유효한지를 검증.
            // 패턴과 일치하는 입력값이면 true, 하나라도 어긋난다면 false.
            $emailInput.style.borderColor = 'red';
            document.getElementById('emailChk').innerHTML = '<b style="color: red; font-size: 20px;">[아이디는 4~14글자의 영문,숫자로 입력하세요!]</b>';
            checkResultList[0] = false;

            } else {
            // 비동기 요청으로 아이디 중복 확인 진행
            fetch('/user/check/email/' + emailInput)
                .then(res => res.json())
                .then(flag => {
                if (flag) { // 중복
                    $emailInput.style.borderColor = 'red';
                    document.getElementById('emailChk').innerHTML = '<b style="color: red; font-size: 20px;">[이메일이 중복되었습니다.]</b>';
                    checkResultList[0] = false;
                
                } else {
                    $emailInput.style.borderColor = 'skyblue';
                    document.getElementById('emailChk').innerHTML = '<b style="color: skyblue; font-size: 20px;">[사용 가능한 이메일입니다.]</b>';
                    checkResultList[0] = true;
                }
                });
            }
        }

         // 패스워드 검사 정규표현식
        const passwordPattern = /([a-zA-Z0-9].*[!,@,#,$,%,^,&,*,?,_,~])|([!,@,#,$,%,^,&,*,?,_,~].*[a-zA-Z0-9])/;

        // 패스워드 입력값 검증
        const $pwInput = document.getElementById('password');

        $pwInput.onkeyup = e => {

            const pwValue = $pwInput.value;
            if (pwValue.trim() === '') {
                $pwInput.style.borderColor = 'red';
                document.getElementById('pwChk').innerHTML = '<b style="color: red; font-size: 20px;">[비밀번호는 필수값입니다!]</b>';
                checkResultList[1] = false;

            } else if (!passwordPattern.test(pwValue)) {
                $pwInput.style.borderColor = 'red';
                document.getElementById('pwChk').innerHTML = '<b style="color: red; font-size: 20px;">[특수문자 포함 8자 이상!]</b>';
                checkResultList[1] = false;

            } else {
                $pwInput.style.borderColor = 'skyblue';
                document.getElementById('pwChk').innerHTML = '<b style="color: skyblue; font-size: 20px;">[사용가능한 비밀번호입니다.]</b>';
                checkResultList[1] = true;
            }

    };


    // 패스워드 확인란 입력값 검증
    const $pwCheckInput = document.getElementById('password_check');
        $pwCheckInput.onkeyup = e => {
        const pwCheckValue = $pwCheckInput.value;
        if (pwCheckValue.trim() === '') {
            $pwCheckInput.style.borderColor = 'red';
            document.getElementById('pwChk2').innerHTML = '<b style="color: red; font-size: 20px;">[비밀번호 확인란은 필수값입니다!]</b>';
            checkResultList[2] = false;

        } else if ($pwCheckInput.value !== $pwInput.value) {
            $pwCheckInput.style.borderColor = 'red';
            document.getElementById('pwChk2').innerHTML = '<b style="color: red; font-size: 20px;">[비밀번호가 다릅니다.]</b>';
            checkResultList[2] = false;

        } else {
            $pwCheckInput.style.borderColor = 'skyblue';
            document.getElementById('pwChk2').innerHTML = '<b style="color: skyblue; font-size: 20px;">[비밀번호가 일치 합니다.]</b>';
            checkResultList[2] = true;
        }
        };


        // 이름 검사 정규표현식
        const namePattern = /^[가-힣]+$/;

        // 이름 입력값 검증
        const $nameInput = document.getElementById('user_name');

        $nameInput.onkeyup = e => {

            const nameValue = $nameInput.value;

            if (nameValue.trim() === '') {
                $nameInput.style.borderColor = 'red';
                document.getElementById('nameChk').innerHTML = '<b style="color: red; font-size: 20px;">[이름은 필수 정보 입니다.!]</b>';
                checkResultList[3] = false;

            } else if (!namePattern.test(nameValue)) {
                $nameInput.style.borderColor = 'red';
                document.getElementById('nameChk').innerHTML = '<b style="color: red; font-size: 20px;">[이름은 한글로 작성해 주세요.]</b>';
                checkResultList[3] = false;

            } else {
                $nameInput.style.borderColor = 'skyblue';
                document.getElementById('nameChk').innerHTML = '<b style="color: skyblue; font-size: 20px;">[사용가능한 이름입니다.]</b>';
                checkResultList[3] = true;
            }

        };

         // 휴대폰 검사 정규표현식
        const phoneNumberPattern = /^(01[016789]{1})-?[0-9]{3,4}-?[0-9]{4}$/;

        // 휴대폰 번호 검증
        const $userPhone = document.getElementById('user_phone');

        $userPhone.onkeyup = e => {

        const userPhone = $userPhone.value;

        if (userPhone.trim() === '') {
            $userPhone.style.borderColor = 'red';
            document.getElementById('phoneNumberChk').innerHTML = '<b style="color: red; font-size: 20px;">[휴대폰 번호는 필수 정보 입니다.!]</b>';
            checkResultList[4] = false;

        } else if (!phoneNumberPattern.test(userPhone)) {
            $userPhone.style.borderColor = 'red';
            document.getElementById('phoneNumberChk').innerHTML = '<b style="color: red; font-size: 20px;">[올바른 휴대폰 번호를 작성해 주세요.]</b>';
            checkResultList[4] = false;

        } else {
            $userPhone.style.borderColor = 'skyblue';
            document.getElementById('phoneNumberChk').innerHTML = '<b style="color: skyblue; font-size: 20px;">[사용가능한 휴대번호 입니다.]</b>';
            checkResultList[4] = true;
        }

        };



        // 회원가입 버튼 클릭 이벤트
        document.getElementById('signup-btn').onclick = e => {

        // 5개의 입력칸이 모두 통과되었을 경우 폼을 서브밋.
        const $form = document.getElementById('signUpForm');

        if (checkResultList.includes(false)) {
        alert('입력란을 다시 확인하세요!');
        } else {
        $form.submit();
        }

        } 
    </script>
</body>

</html>